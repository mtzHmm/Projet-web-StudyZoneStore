<div #historyContainer class="w-full max-w-6xl mx-auto mt-10 mb-20 p-6 rounded-2xl 
            bg-[radial-gradient(ellipse_50%_50%_at_50%_50%,_rgba(0,0,0,0)_0%,_rgba(146,54,255,0.1)_100%)]
            shadow-[0px_2px_10px_0px_rgba(0,0,0,0.25)] 
            shadow-[0px_4px_250px_0px_rgba(146,54,255,0.25)]
            outline outline-1 outline-black backdrop-blur-lg
            flex flex-col overflow-y-auto scrollbar-transparent max-h-[600px]">

  <!-- Header -->
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-3xl font-bold mt-10 mb-4 text-white">
      Order history of {{ clientName }}
    </h2>

    <!-- Search -->
    <div class="flex items-center gap-2">
      <span class="text-zinc-400">ðŸ”Ž</span>
      <input [(ngModel)]="searchTerm"
             (ngModelChange)="onSearchChange()"
             placeholder="Search by ID, total, status or date..."
             class="w-80 p-2 rounded-lg bg-zinc-900 border border-zinc-700 text-white outline-none focus:border-violet-400 transition" />
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="mb-4 p-4 bg-red-500/20 border border-red-500/50 rounded-lg text-red-200">
    {{ errorMessage }}
  </div>

  <!-- Stats Info -->
  <div *ngIf="totalOrders > 0" class="mb-4 text-sm text-zinc-400">
    Showing {{ filteredOrders.length }} order(s) out of {{ totalOrders }} total
  </div>

  <!-- Table -->
  <div class="overflow-hidden rounded-xl border border-zinc-700">
    <!-- Header -->
    <div class="grid grid-cols-4 bg-zinc-800 text-zinc-400 font-semibold text-lg px-6 py-3 sticky top-0 z-10">
      <div>ID</div>
      <div>Total</div>
      <div>Statut</div>
      <div>Date & Actions</div>
    </div>

    <!-- Rows -->
    <div *ngFor="let order of filteredOrders"
         class="grid grid-cols-4 px-6 py-4 border-t border-zinc-700 items-center 
                hover:bg-zinc-800/40 transition text-white rounded-lg">

      <div class="font-mono text-sm">#{{ order.id }}</div>
      <div class="text-yellow-400 font-bold">{{ calculateOrderTotal(order) | number:'1.2-2' }} DT</div>
      
      <!-- Status badge -->
      <div>
        <span [ngClass]="{
          'bg-yellow-600 text-yellow-100': order.status === 'pending',
          'bg-blue-600 text-blue-100': order.status === 'confirmed',
          'bg-green-600 text-green-100': order.status === 'delivered',
          'bg-red-600 text-red-100': order.status === 'cancelled'
        }" class="px-2 py-1 rounded-full text-xs font-medium uppercase">
          {{ order.status }}
        </span>
      </div>
      
      <!-- Date and Actions -->
      <div class="flex justify-between items-center">
        <span class="text-sm text-zinc-300">{{ order.orderDate | date:'dd/MM/yyyy' }}</span>

        <!-- Bouton chariot -->
        <button (click)="goToDetails(order)"
                class="ml-2 w-8 h-8 flex items-center justify-center 
                       bg-zinc-800 rounded-md hover:bg-violet-500 transition"
                title="Voir les dÃ©tails de la commande">
          ðŸ›’
        </button>
      </div>
    </div>

    <!-- Loading indicator -->
    <div *ngIf="isLoading" class="flex justify-center items-center py-6 border-t border-zinc-700">
      <div class="flex items-center gap-2 text-violet-400">
        <div class="animate-spin rounded-full h-5 w-5 border-b-2 border-violet-400"></div>
        <span>Chargement de l'historique...</span>
      </div>
    </div>

    <!-- No more data indicator -->
    <div *ngIf="!hasMoreData && filteredOrders.length > 0 && !isLoading" 
         class="text-center py-4 text-zinc-400 border-t border-zinc-700">
      Tout l'historique a Ã©tÃ© affichÃ©
    </div>

    <!-- No results found -->
    <div *ngIf="filteredOrders.length === 0 && !isLoading" 
         class="text-center py-8 text-zinc-400">
      Aucune commande trouvÃ©e
    </div>
  </div>

  <!-- Retour Dashboard -->
  <div class="mt-6 flex justify-center">
    <button routerLink="/user-management"
            class="px-6 py-3 bg-violet-600 hover:bg-violet-700 rounded-xl shadow-lg text-white font-semibold">
      â¬… Back to User management
    </button>
  </div>
</div>
