<div class="min-h-screen flex items-center justify-start p-4">
  <div class="flex gap-4 max-w-none w-full">
    <app-sidebar class="w-56 sticky top-4 self-start h-[calc(100vh-2rem)] overflow-hidden"></app-sidebar>
    <div class="flex-1 text-white p-4 space-y-4">

  <!-- Contenu principal -->
  <div class="text-white">
    
    <!-- Header with Controls -->
    <div class="flex items-center justify-between mb-8 px-4">
      <div>
        <h1 class="text-3xl font-bold text-violet-400 mb-2">Dashboard Statistics</h1>
        <p class="text-gray-400 text-sm">Last updated: {{ getLastUpdatedTime() }}</p>
      </div>
      <div class="flex items-center gap-3">
        <!-- Data Source Indicator -->
        <div *ngIf="!usingMockData && !loading" class="px-3 py-1 bg-green-500/20 border border-green-500 rounded-lg">
          <span class="text-green-400 text-sm">ðŸ”— Live Data</span>
        </div>
        <div *ngIf="usingMockData && !loading" class="px-3 py-1 bg-orange-500/20 border border-orange-500 rounded-lg">
          <span class="text-orange-400 text-sm">ðŸ“Š Demo Data</span>
        </div>
        <!-- Refresh Button -->
        <button (click)="refreshStats()" 
                [disabled]="loading"
                class="px-4 py-2 bg-violet-600 hover:bg-violet-700 disabled:opacity-50 text-white rounded-lg transition-colors flex items-center gap-2">
          <span class="text-sm" [class.animate-spin]="loading">ðŸ”„</span>
          <span class="text-sm">{{ loading ? 'Loading...' : 'Refresh' }}</span>
        </button>
        <button (click)="exportStats()" 
                class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors flex items-center gap-2">
          <span class="text-sm">ðŸ“Š</span>
          <span class="text-sm">Export</span>
        </button>
      </div>
    </div>
    
    <!-- Grid des cartes statistiques -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-8 px-4">
      <div *ngFor="let card of statsCards" 
           class="bg-white/10 backdrop-blur-sm rounded-2xl p-8 border border-white/20 hover:bg-white/15 hover:scale-105 transition-all duration-300 min-w-0 cursor-pointer"
           (click)="viewDetails(card.title)">
        
        <!-- Header avec icÃ´ne -->
        <div class="flex justify-between items-start mb-4">
          <div class="text-sm text-gray-300 font-medium">{{ card.title }}</div>
          <div class="text-2xl">{{ card.icon }}</div>
        </div>
        
        <!-- Valeur principale -->
        <div class="text-3xl font-bold text-white mb-2">{{ card.value }}</div>
        
        <!-- Pourcentage et lien -->
        <div class="flex justify-between items-center">
          <div class="flex items-center gap-2">
            <span class="w-2 h-2 rounded-full" 
                  [class]="card.isPositive ? 'bg-green-500' : 'bg-red-500'"></span>
            <span class="text-sm" 
                  [class]="card.isPositive ? 'text-green-400' : 'text-red-400'">{{ card.percentage }}</span>
          </div>
          <button (click)="viewDetails(card.title); $event.stopPropagation()" 
                  class="text-sm text-purple-400 hover:text-purple-300 transition-colors">{{ card.viewReport }}</button>
        </div>
      </div>
    </div>

    <!-- Section graphiques -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-12 px-4">
      
      <!-- Graphique en ligne - Sales per Month -->
      <div class="lg:col-span-2 bg-white/10 backdrop-blur-sm rounded-2xl p-8 border border-white/20">
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-lg font-semibold">Sales per month</h3>
          <div class="text-sm text-gray-400">
            Year {{ getCurrentYear() }} â€¢ Total: {{ getTotalSalesCount() }} sales
          </div>
        </div>
        
        <!-- Sales Chart with Real Data -->
        <div class="relative h-64">
          <!-- Background Grid -->
          <div class="absolute inset-0 grid grid-cols-11 grid-rows-4">
            <div *ngFor="let i of [].constructor(44)" 
                 class="border-r border-b border-white/10"></div>
          </div>
          
          <!-- Chart Line and Points -->
          <svg class="absolute inset-0 w-full h-full" viewBox="0 0 400 200" *ngIf="chartData.length > 0">
            <!-- Generate path for sales line -->
            <polyline 
              [attr.points]="generateSalesChartPoints()"
              fill="none" 
              stroke="#60a5fa" 
              stroke-width="3"
              class="drop-shadow-lg"/>
            
            <!-- Points on the line -->
            <circle *ngFor="let point of chartData; let i = index" 
                    [attr.cx]="20 + (i * 32)" 
                    [attr.cy]="getSalesPointY(point.value)"
                    r="6" 
                    fill="#60a5fa" 
                    stroke="white"
                    stroke-width="2"
                    class="drop-shadow-lg cursor-pointer hover:fill-violet-400 transition-colors"
                    (click)="onChartPointClick(point)"
                    [title]="point.month + ': ' + point.value + ' sales'"/>
            
            <!-- Value labels on hover points -->
            <text *ngFor="let point of chartData; let i = index"
                  [attr.x]="20 + (i * 32)"
                  [attr.y]="getSalesPointY(point.value) - 15"
                  text-anchor="middle"
                  fill="white"
                  font-size="10"
                  class="opacity-75">
              {{ point.value > 0 ? point.value : '' }}
            </text>
          </svg>
          
          <!-- Month Labels -->
          <div class="absolute bottom-0 left-0 right-0 flex justify-between text-xs text-gray-400 px-4">
            <span *ngFor="let point of chartData">{{ point.month }}</span>
          </div>
          
          <!-- Y-axis Labels (Dynamic based on max sales) -->
          <div class="absolute left-0 top-0 bottom-0 flex flex-col justify-between text-xs text-gray-400 py-4">
            <span>{{ salesMaxValue }}</span>
            <span>{{ getSalesYAxisLabel(0.75) }}</span>
            <span>{{ getSalesYAxisLabel(0.5) }}</span>
            <span>{{ getSalesYAxisLabel(0.25) }}</span>
            <span>0</span>
          </div>
        </div>
        
        <!-- Sales Summary -->
        <div class="mt-4 pt-4 border-t border-white/10 grid grid-cols-3 gap-4 text-center">
          <div>
            <div class="text-lg font-semibold text-green-400">{{ getTotalSalesCount() }}</div>
            <div class="text-xs text-gray-400">Total Sales</div>
          </div>
          <div>
            <div class="text-lg font-semibold text-blue-400">{{ getAverageSalesPerMonth() }}</div>
            <div class="text-xs text-gray-400">Avg/Month</div>
          </div>
          <div>
            <div class="text-lg font-semibold text-purple-400">{{ getBestSalesMonth() }}</div>
            <div class="text-xs text-gray-400">Best Month</div>
          </div>
        </div>
      </div>

      <!-- Graphique en camembert -->
      <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-8 border border-white/20">
        <h3 class="text-lg font-semibold mb-6">best sellers of the month</h3>
        
        <!-- Graphique en camembert dynamique -->
        <div class="flex justify-center items-center h-64">
          <div class="relative w-48 h-48">
            <svg class="w-full h-full" viewBox="0 0 100 100">
              <!-- Segments gÃ©nÃ©rÃ©s dynamiquement -->
              <path *ngFor="let item of pieChartData; let i = index"
                    [attr.d]="getSegmentPath(i)"
                    [attr.fill]="item.color"
                    class="opacity-90 hover:opacity-100 hover:scale-105 transition-all cursor-pointer"
                    [title]="item.name + ': ' + getPercentage(item.value) + '%'"
                    (click)="onPieSegmentClick(item)"/>
            </svg>
            
            <!-- Labels du centre -->
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="text-center">
                <div class="text-2xl font-bold">{{ getTotalSales() }}</div>
                <div class="text-sm text-gray-300">Total Sales</div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- LÃ©gende dynamique -->
        <div class="mt-4 space-y-2">
          <div *ngFor="let item of pieChartData; let i = index" 
               class="flex items-center justify-between hover:bg-white/5 p-2 rounded transition-colors">
            <div class="flex items-center gap-2">
              <div class="w-3 h-3 rounded" [style.background-color]="item.color"></div>
              <span class="text-sm text-gray-300">{{ item.name }}</span>
            </div>
            <div class="text-sm font-medium text-white">
              {{ getPercentage(item.value) }}% ({{ item.value }})
            </div>
          </div>
        </div>

        <!-- Statistiques supplÃ©mentaires -->
        <div class="mt-4 pt-4 border-t border-white/10">
          <div class="text-xs text-gray-400 text-center">
            Most popular: {{ pieChartData[0].name }} ({{ getPercentage(pieChartData[0].value) }}%)
          </div>
        </div>
      </div>
    </div>
  </div>
  
  </div>
  </div>
</div>




